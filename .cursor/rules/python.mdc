---
description: Python best practices and patterns for modern software development with Django and SQLite
globs: **/*.py
alwaysApply: true
---

# Python Best Practices

## Project Structure

- Place tests in `tests/` directory within each app
- Keep configuration in `agora/settings.py` or as environment variables in `.env`
- Store requirements in `pyproject.toml` using `uv`
- Place static files in `static/` directory
- Use `templates/` for Django templates
- Apps are organized in `agora/apps/`

## Code Style

- Use `ruff` for code formatting and linting
- Follow PEP 8 naming conventions:
  - snake_case for functions and variables
  - PascalCase for classes
  - UPPER_CASE for constants
- Maximum line length of 100 characters
- Use absolute imports over relative imports
- Sort imports with `ruff`

## Type Hints

- Use type hints for all function parameters and returns
- Import types from `typing` module
- Use `Optional[Type]` instead of `Type | None`
- Use `TypeVar` for generic types
- Define custom types in `types.py`
- Use `Protocol` for duck typing

## Database

- Use Django ORM
- Use proper connection pooling
- Implement proper relationships
- Use proper indexing strategies

## Authentication

- Use Keycloak as external IDP with Django's REMOTE_USER middleware
- Authentication logic is in `agora/auth.py` and `agora/keycloak_admin.py`
- Use proper session security
- Implement CSRF protection
- Use proper role-based access control

## API Design

- Use Django Ninja for REST APIs
- Implement proper request validation
- Use proper HTTP status codes
- Handle errors consistently
- Use proper response formats
- Implement proper rate limiting

## Testing

- Use Django's built-in testing framework (unittest and django TestCase)
- Write tests for all routes
- Implement proper fixtures
- Use proper mocking with unittest.mock
- Test all error scenarios
- Run tests with `just test-backend`

## Security

- Use HTTPS in production
- Implement proper CORS
- Sanitize all user inputs
- Use proper session configuration
- Implement proper logging
- Follow OWASP guidelines

## Performance

- Use proper caching with Django cache
- Implement database query optimization
- Use proper connection pooling
- Implement proper pagination
- Use background tasks for heavy operations
- Monitor application performance

## Error Handling

- Create custom exception classes
- Use proper try-except blocks
- Implement proper logging
- Return proper error responses
- Handle edge cases properly
- Use proper error messages

## Documentation

- Use Google-style docstrings
- Document all public APIs
- Keep README.md updated
- Use proper inline comments
- Generate API documentation
- Document environment setup

## Development Workflow

- Use `uv` tooling for package management
- Use `just` for task running
- Use proper Git workflow
- Follow semantic versioning
- Use proper CI/CD practices
- Implement proper logging with `structlog`

## Dependencies

- Pin dependency versions
- Use `pyproject.toml` and separate dev dependencies
- Use proper package versions
- Regularly update dependencies
- Check for security vulnerabilities
